---
title: My take on database access
---

<p>I like my code to be useful, so an object that can do a number of different things is gonna make me happy.</p>
    <p>What I found lacking in some DAOs I've seen out there, is that the WHERE clauses are restricted to acting on the primary key only. So for SELECTs, UPDATEs and DELETEs you'd have to know the primary key, which you usually do, but you may have to obtain this if you don't.</p>
    <p>The same is true with INSERTs. I want my INSERTs to contain any columns.</p>
    <p>So what I set out to create, was a CRUD object that could:</p>
    <ul>   <li>INSERT any combination of columns</li>   <li>SELECT any columns, with anything in the WHERE clause and ORDER BY any columns</li>   <li>UPDATE any columns based on any WHERE clause columns (I stopped short of doing this as you'll see below)</li>   <li>DELETE any row based on any columns in the WHERE clause</li>  </ul>    <p>This is what I came up with:</p>
    <pre style="background: #ff9; padding: 15px; overflow-x: auto; overflow-y: hidden;">&lt;cfcomponent displayname=&quot;UserDAO&quot;&gt;      &lt;cfset VARIABLES.dsn = &quot;&quot;&gt;        &lt;cffunction name=&quot;init&quot;&gt;      &lt;cfargument name=&quot;dsn&quot;&gt;      &lt;cfset VARIABLES.dsn = ARGUMENTS.dsn&gt;      &lt;cfreturn THIS&gt;    &lt;/cffunction&gt;        &lt;cffunction name=&quot;create&quot;&gt;            &lt;cfset var separator = &quot;&quot;&gt;      &lt;cfset var q = &quot;&quot;&gt;            &lt;cfquery name=&quot;q&quot; datasource=&quot;#VARIABLES.DSN#&quot;&gt;        INSERT INTO [user] (          &lt;cfif StructKeyExists(ARGUMENTS, &quot;userID&quot;)&gt;#separator#userID&lt;cfset separator = &quot;,&quot;&gt;&lt;/cfif&gt;          &lt;cfif StructKeyExists(ARGUMENTS, &quot;firstName&quot;)&gt;#separator#firstName&lt;cfset separator = &quot;,&quot;&gt;&lt;/cfif&gt;          &lt;cfif StructKeyExists(ARGUMENTS, &quot;lastName&quot;)&gt;#separator#lastName&lt;cfset separator = &quot;,&quot;&gt;&lt;/cfif&gt;        ) VALUES (          &lt;cfset separator = &quot;&quot;&gt;          &lt;cfif StructKeyExists(ARGUMENTS, &quot;userID&quot;)&gt;#separator#&lt;cfqueryparam... value=&quot;#ARGUMENTS.userID#&quot;&gt;&lt;cfset separator = &quot;,&quot;&gt;&lt;/cfif&gt;          &lt;cfif StructKeyExists(ARGUMENTS, &quot;firstName&quot;)&gt;#separator#&lt;cfqueryparam... value=&quot;#ARGUMENTS.firstName#&quot;&gt;&lt;cfset separator = &quot;,&quot;&gt;&lt;/cfif&gt;          &lt;cfif StructKeyExists(ARGUMENTS, &quot;lastName&quot;)&gt;#separator#&lt;cfqueryparam... value=&quot;#ARGUMENTS.lastName#&quot;&gt;&lt;cfset separator = &quot;,&quot;&gt;&lt;/cfif&gt;        )        SELECT SCOPE_IDENTITY() userID      &lt;/cfquery&gt;            &lt;cfreturn q.userID&gt;        &lt;/cffunction&gt;        &lt;cffunction name=&quot;read&quot;&gt;          &lt;cfargument name=&quot;columnList&quot; default=&quot;*&quot;&gt;      &lt;cfargument name=&quot;orderByList&quot; default=&quot;&quot;&gt;            &lt;cfset var q = &quot;&quot;&gt;            &lt;cfquery name=&quot;q&quot; datasource=&quot;#VARIABLES.dsn#&quot;&gt;        SELECT #ARGUMENTS.columnList#        FROM [user]        WHERE 1 = 1        &lt;cfif StructKeyExists(ARGUMENTS, &quot;userID&quot;)&gt;AND userID = &lt;cfqueryparam... value=&quot;#ARGUMENTS.userID#&quot;&gt;&lt;/cfif&gt;        &lt;cfif StructKeyExists(ARGUMENTS, &quot;firstName&quot;)&gt;AND firstName = &lt;cfqueryparam... value=&quot;#ARGUMENTS.firstName#&quot;&gt;&lt;/cfif&gt;        &lt;cfif StructKeyExists(ARGUMENTS, &quot;lastName&quot;)&gt;AND lastName = &lt;cfqueryparam... value=&quot;#ARGUMENTS.lastName#&quot;&gt;&lt;/cfif&gt;        &lt;cfif ARGUMENTS.orderByList NEQ &quot;&quot;&gt;          ORDER BY #ARGUMENTS.orderByList#        &lt;/cfif&gt;      &lt;/cfquery&gt;            &lt;cfreturn q&gt;        &lt;/cffunction&gt;        &lt;cffunction name=&quot;update&quot;&gt;            &lt;cfargument name=&quot;userID&quot; required=&quot;true&quot;&gt;            &lt;cfset var separator = &quot;&quot;&gt;            &lt;cfquery name=&quot;q&quot; datasource=&quot;#VARIABLES.DSN#&quot;&gt;        UPDATE [user] SET        &lt;cfif StructKeyExists(ARGUMENTS, &quot;firstName&quot;)&gt;#separator#firstName = &lt;cfqueryparam... value=&quot;#ARGUMENTS.firstName#&quot;&gt;&lt;cfset separator = &quot;,&quot;&gt;&lt;/cfif&gt;        &lt;cfif StructKeyExists(ARGUMENTS, &quot;lastName&quot;)&gt;#separator#lastName = &lt;cfqueryparam... value=&quot;#ARGUMENTS.lastName#&quot;&gt;&lt;cfset separator = &quot;,&quot;&gt;&lt;/cfif&gt;        WHERE userID = &lt;cfqueryparam... value=&quot;#ARGUMENTS.userID#&quot;&gt;      &lt;/cfquery&gt;          &lt;/cffunction&gt;        &lt;cffunction name=&quot;delete&quot;&gt;            &lt;cfset var q = &quot;&quot;&gt;            &lt;cfquery name=&quot;q&quot; datasource=&quot;#VARIABLES.dsn#&quot;&gt;        DELETE FROM [user]        WHERE 1 = 1        &lt;cfif StructKeyExists(ARGUMENTS, &quot;userID&quot;)&gt;AND userID = &lt;cfqueryparam... value=&quot;#ARGUMENTS.userID#&quot;&gt;&lt;/cfif&gt;        &lt;cfif StructKeyExists(ARGUMENTS, &quot;firstName&quot;)&gt;AND firstName = &lt;cfqueryparam... value=&quot;#ARGUMENTS.firstName#&quot;&gt;&lt;/cfif&gt;        &lt;cfif StructKeyExists(ARGUMENTS, &quot;lastName&quot;)&gt;AND lastName = &lt;cfqueryparam... value=&quot;#ARGUMENTS.lastName#&quot;&gt;&lt;/cfif&gt;      &lt;/cfquery&gt;            &lt;cfreturn true&gt;          &lt;/cffunction&gt;      &lt;/cfcomponent></pre>    <p>I've stripped out some attributes and comments for the sake of this post. For the most part this is the code I'm using on my latest project and it has been working like a charm.</p>
    <p>Inserting a row:</p>
    <pre style="background: #ff9; padding: 15px;">   &lt;cfset userDAO = CreateObject(&quotcomponent&quot, &quotcfc.UserDAO&quot).init(APPLICATION.DSN)&gt;   &lt;cfset userDAO.create(firstName = &quotAdrian&quot, lastName = &quotLynch&quot)&gt;  </pre>    <p>Selecting all rows where first name is Adrian:</p>
    <pre style="background: #ff9; padding: 15px;">   &lt;cfset adrians = userDAO.read(firstName = &quotAdrian&quot)&gt;  </pre>    <p>Updating:</p>
    <pre style="background: #ff9; padding: 15px;">   &lt;cfset userDAO.update(firstName = &quotAuthor&quot, userID = 1)&gt;  </pre>    <p>Deleting Adrians:</p>
    <pre style="background: #ff9; padding: 15px;">   &lt;cfset userDAO.delete(firstName = &quotArthur&quot)&gt;  </pre>    <p>Or making a mistake and deleting all rows!</p>
    <pre style="background: #ff9; padding: 15px;">   &lt;cfset adrians = userDAO.delete()&gt;  </pre>    <p>All this is auto generated with a tool I use. Inspired by <a href="http://cfcgenerator.riaforge.org/">Illudium PU-36</a> but wanting it to work across multiple tables I created my own version, but that's a post for another time. Here's a screen shot.</p>
    <a href="images/ace.gif"><img src="images/ace-thumb.gif" width="400" height="323" alt="Screen shot of the code generator" /></a>    <p>I'd love to hear people's thoughts on the above as I quite like it.</p>
